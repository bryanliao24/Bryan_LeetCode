class ListNode:
    def __init__(self, key: int, value: int):
        self.key = key
        self.value = value
        self.prev = self
        self.next = self

class LRUCache:

    def __init__(self, capacity: int):
        self.dic = {}
        self.capacity = capacity
        self.size = 0
        self.root = ListNode(0, 0)

    def get(self, key: int) -> int:
        if key in self.dic :
            node = self.dic[key]
            self.removeFromList(node)
            self.insertIntoHead(node)
            return node.value
        else:
            return -1
        
    def put(self, key: int, value: int) -> None:
        if key in self.dic:
            node = self.dic[key]
            self.removeFromList(node)
            self.insertIntoHead(node)
            node.value = value
        else:
            if self.size >= self.capacity:
                self.removeFromTail()
                self.size -= 1
            node = ListNode(key, value)
            self.insertIntoHead(node)
            self.dic[key] = node
            self.size += 1

    def removeFromList(self, node):
        if node == self.root: return
        prev_node = node.prev
        next_node = node.next
        prev_node.next = next_node
        next_node.prev = prev_node
        node.prev = node.next = None
    
    def insertIntoHead(self, node):
        head_node = self.root.next
        head_node.prev = node
        node.prev = self.root
        self.root.next = node
        node.next = head_node
    
    def removeFromTail(self):
        if self.size == 0: return
        tail_node = self.root.prev
        del self.dic[tail_node.key]
        self.removeFromList(tail_node)
        
        
        
obj = LRUCache(2);                   # 对应 "LRUCache", [2]
print(obj.put(1, 1))            # 对应 "put", [1, 1]
print(obj.put(2, 2))            # 对应 "put", [2, 2]
print(obj.get(1))               # 对应 "get", [1]
print(obj.put(3, 3))            # 对应 "put", [3, 3]
print(obj.get(2))               # 对应 "get", [2]
print(obj.put(4, 4))            # 对应 "put", [4, 4]
print(obj.get(1))               # 对应 "get", [1]
print(obj.get(3))               # 对应 "get", [3]
print(obj.get(4))               # 对应 "get", [4]        
        
        
        
        
