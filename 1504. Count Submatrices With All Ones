ğŸ”¹ ç¬¬ä¸€æ¬¡ï¼šæ©«å‘ç–Šï¼ˆå·¦åˆ°å³ï¼‰
ç”¨ left[r][c] ç®—å‡ºã€Œé€™å€‹æ ¼å­å¾€å·¦é€£çºŒæœ‰å¤šå°‘å€‹ 1ã€
ğŸ‘‰ é€™æ¨£å°±çŸ¥é“ï¼Œå¦‚æœæˆ‘è¦ä¸€å€‹çŸ©å½¢çš„å³ä¸‹è§’åœ¨ (r,c)ï¼Œé‚£éº¼å®ƒçš„æœ€å¤§å¯¬åº¦æ˜¯å¤šå°‘ã€‚

ğŸ”¹ ç¬¬äºŒæ¬¡ï¼šç¸±å‘ç–Šï¼ˆä¸‹åˆ°ä¸Šï¼‰
å°æ¯å€‹ (r,c) å¾€ä¸Šèµ°ï¼Œçœ‹èƒ½ç–Šå¹¾è¡Œï¼š
æ¯å¾€ä¸Šä¸€è¡Œï¼Œæ›´æ–°ä¸€æ¬¡ æœ€å°å¯¬åº¦ = min(ä¹‹å‰çš„, left[k][c])
å› ç‚ºå¾€ä¸Šæ“´å±•æ™‚ï¼ŒçŸ©å½¢çš„å¯¬åº¦å¯èƒ½æœƒè¢«æ›´ä¸Šé¢çš„ä¸€è¡Œé™åˆ¶ä½
æ¯ç–Šä¸€è¡Œï¼Œå°±æŠŠã€Œé€™å€‹é«˜åº¦ä¸‹èƒ½æœ‰çš„çŸ©å½¢æ•¸ã€åŠ åˆ°ç­”æ¡ˆ

class Solution:
    def numSubmat(self, mat: List[List[int]]) -> int:
        m, n = len(mat), len(mat[0])
        # 1) left[r][c] = è©²æ ¼å­å‘å·¦é€£çºŒ 1 çš„é•·åº¦
        left = [[0]*n for _ in range(m)]
        for r in range(m):
            run = 0
            for c in range(n):
                if mat[r][c] == 1:
                    run += 1
                else:
                    run = 0
                left[r][c] = run

        # 2) ä»¥æ¯å€‹ (r,c) ç‚ºå³ä¸‹è§’ï¼Œå¾€ä¸Šç–Š
        ans = 0
        for r in range(m):
            for c in range(n):
                if mat[r][c] == 0:
                    continue
                minW = float('inf')
                k = r
                while k >= 0 and left[k][c] > 0:
                    minW = min(minW, left[k][c])
                    ans += minW
                    k -= 1
        return ans

-------------------------------------------------------------------------------------


å¯¹æ¯ä¸€è¡Œ rï¼Œæˆ‘ä»¬æŠŠçŸ©é˜µå½“æˆä¸€å¼ â€œç›´æ–¹å›¾â€, heights[c] è¡¨ç¤ºä»å½“å‰è¡Œ r å¾€ä¸Šè¿ç»­çš„ 1 çš„ä¸ªæ•°

class Solution:
    def numSubmat(self, mat: List[List[int]]) -> int:
        if not mat or not mat[0]:
            return 0
        m, n = len(mat), len(mat[0])
        heights = [0] * n
        ans = 0

        for r in range(m):
            # 1) æ›´æ–°ç›´æ–¹å›¾é«˜åº¦
            for c in range(n):
                heights[c] = heights[c] + 1 if mat[r][c] == 1 else 0

            # 2) ç”¨å•è°ƒæ ˆç»Ÿè®¡ä»¥æ¯ä¸€åˆ—ä¸ºå³è¾¹ç•Œçš„å­çŸ©é˜µæ•°é‡
            stack = []          # (height, count)
            curr_sum = 0        # ä»¥å½“å‰åˆ—ä¸ºå³è¾¹ç•Œçš„çŸ©å½¢æ€»æ•°
            for c in range(n):
                h = heights[c]
                count = 1
                while stack and stack[-1][0] >= h:
                    prev_h, prev_cnt = stack.pop()
                    curr_sum -= (prev_h - h) * prev_cnt
                    count += prev_cnt
                stack.append((h, count))
                curr_sum += h
                ans += curr_sum

        return ans
        
